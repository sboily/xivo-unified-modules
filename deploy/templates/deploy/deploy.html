{% extends "base.html" %}
{% block content %}

<div class="container">

<div class="widget stacked widget-table action-table">
  <p class="text-right"><a class="btn btn-primary btn-small" href="{{url_for('deploy.deploy_add')}}"><i class="icon-plus icon-white"></i> {{_('Add') }}</a></p>
  <table class="table table-bordered">
<div class="widget-content">
  <table class="table table-bordered table-striped table-highlight">
    <thead>
      <tr>
        <th>{{ _('Name') }}</th>
        <th>{{ _('Status') }}</th>
        <th>{{ _('Created at') }}</th>
      <th class="td-actions"></th>
      </tr>
    </thead>
    <tbody>
    {% for s in servers %}
      <tr>
      <td>{{ s.name }}</td>
      <td class="status" id="{{ s.id }}"></td>
      <td>{{ s.created_time }}</td>
      <td class="td-actions">
        <a href="{{url_for('deploy.deploy_del', id=s.id)}}" class="btn btn-small"><i class="btn-icon-only icon-remove"></i></a>
        {% if s.status == 1 %}
            <a href="{{url_for('deploy.deploy_cloud', id=s.id)}}" class="btn btn-small"><i class="btn-icon-only icon-upload"></i></a>
        {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<script>

function loadStatus() {
    $.getJSON('/deploy/status',
         function(data) {
             $.each( data, function( key, val ) {
                 $('.status').attr('id', key).text(val);
             })
          });
          setTimeout(loadStatus, 2000);
    }

loadStatus();

</script> 

</div>

{% endblock %}
